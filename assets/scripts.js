const _0x271749=_0x5930;!function(t,e){const o=_0x5930,a=_0x28ae();for(;;)try{if(991354===parseInt(o(407))/1*(parseInt(o(418))/2)+-parseInt(o(333))/3+-parseInt(o(309))/4*(-parseInt(o(258))/5)+parseInt(o(482))/6+parseInt(o(414))/7*(-parseInt(o(316))/8)+parseInt(o(449))/9+-parseInt(o(451))/10*(parseInt(o(308))/11))break;a.push(a.shift())}catch(t){a.push(a.shift())}}();import*as _0x3d167c from"three";import{OrbitControls}from"https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/controls/OrbitControls.js";import{EffectComposer}from"https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/postprocessing/EffectComposer.js";import{RenderPass}from"https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/postprocessing/RenderPass.js";import{AfterimagePass}from"https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/postprocessing/AfterimagePass.js";import{makeMat}from"./mins.js";!window[_0x271749(347)]&&(window.Heartlove={data:{messages:[_0x271749(204),_0x271749(335)],images:[],heartColor:_0x271749(351)}}),function(){const t=_0x271749,e=new URLSearchParams(window[t(271)][t(455)])[t(284)](t(262));if(e)try{const o=decodeURIComponent(escape(atob(e))),a=JSON[t(290)](o);if(window[t(347)]={data:{messages:a.messages||[],images:a[t(345)]||[],heartColor:a[t(434)]||"#ff9090",music:a[t(289)]||null}},console.log(t(473),window.Heartlove),window[t(347)][t(262)][t(289)]){const e=new Audio(window[t(347)][t(262)][t(289)]);e.loop=!0;const o=document[t(247)](t(412));o.id="musicToggle",o[t(243)]=t(484),document[t(328)][t(366)](o);let a=!1;const s=()=>{const e=t;o[e(243)]='<i class="fas '+e(a?205:196)+e(294)},r=()=>{const o=t;e[o(405)]()[o(303)]((()=>{a=!0,s()}))[o(436)]((()=>{const t=o;console.log(t(312))}))},n=()=>{e[t(339)](),a=!1,s()};o[t(401)](t(446),(()=>{a?n():r()})),e[t(405)]()[t(303)]((()=>{a=!0,s()}))[t(436)]((()=>{const e=t,o=()=>{const t=_0x5930;r(),document[t(374)](t(446),o)};document.addEventListener(e(446),o)}))}}catch(e){console[t(462)]("Dữ liệu không hợp lệ:",e),window[t(347)]=null}else console[t(240)](t(248))}();const appData=window[_0x271749(347)][_0x271749(262)],apps="hieu22012003.github.io";let allWordsFlat=[];const originalTexts=appData[_0x271749(461)]||[];originalTexts[_0x271749(419)]((t=>{const e=_0x271749,o=t[e(298)](" ");allWordsFlat[e(323)](...o)}));let currentWordIndex=0,nextWordSpawnTime=0;const WORD_SPAWN_INTERVAL=.4,IMAGE_CONFIG={paths:appData[_0x271749(345)]||[],count:appData[_0x271749(345)]?.[_0x271749(433)]||0,scale:2.5,glowIntensity:.4,spawnRate:.18,maxActiveImages:45,spawnInterval:400};function _0x28ae(){const t=["STREAM","https://github.com/Panbap/anh/blob/main/error/myheartv1a1.png?raw=true","push","gesturestart","LinearFilter","normalize","domElement","body","hostname","lifeDuration","PointLight","none","4019739LTSFlD","paths","mãi yêu em","imageIndex","Color","matrixWorld","pause","userData","clear","rgb(241, 121, 185)","abs","#ff149300","images","MeshBasicMaterial","Heartlove","beginPath","userAgent","CanvasTexture","#ff9090","DoubleSide","twinkleSpeed","getAzimuthalAngle","textBaseline","filter","lookAt","multiplyScalar","hypot","splice","width=device-width, initial-scale=1.0, user-scalable=no","sparkles","Mesh","sin","pointerdown","appendChild","needsUpdate","attributes","getContext","pow","100vw","renderOrder","opacity","removeEventListener","rgba(255,255,255,0.5)","bezierCurveTo","array","rgba(255,255,255,1)","index","alpha","texts","delete","offset","strokeStyle","indexOf","enablePan","#include <project_vertex>\n  vAlpha = alpha;","fillStyle","matrixWorldInverse","degToRad","log","geometry","clone","Float32BufferAttribute","baseOpacity","gestureend","rgba(255,20,147,0)","add","width","change","addEventListener","fadeStage","priority","acos","play","#ff69b400","1tKVmYD","sqrt","applyMatrix4","getDelta","wrapS","button","update","4427220TLFwmf","spawnTime","damp","rgba(255,255,255,0)","1962124IEKwBz","forEach","value","load","Group","count","vertexShader","fillRect","setFromSphericalCoords","slice","offsetHSL","closePath","WebGLRenderer","maxDistance","innerText","length","heartColor","middle","catch","updateMatrixWorld","minDistance","rotation","rgba(0,0,0,0)","join","visible","canvas","gesturechange","setAttribute","click","alphaTest","preventDefault","9816426BywKgu","trim","1130Ldyfxh","aspectScale","setUsage","format","search","Scene","height","children","radius","traverse","messages","error","isSprite","devicePixelRatio","magFilter","scale","Vector3","material","auto","fixed",'bold 80px "Mali", sans-serif',"active","Heartlove data đã được load:","head","repeat","STAR","#ffffff","particleIndex","text","onerror","font","6741900MMKsYG","color",'<i class="fas fa-volume-high"></i>',"style","onload","fa-volume-xmark","uniforms","life","addPass","varying float vAlpha;\nvoid main(){","waves","crossVectors","rgba(160, 30, 95, 0.9)","Anh yêu em","fa-volume-high","lerp","image","Points","#include <project_vertex>","autoClear","depthWrite","creationTime","includes","fragmentShader","size","HEART","strokeText","setRGB","cos","transparent","phase","floor","Vector2","ray","clientY","atan2","innerHeight","ceil","resize","velocities","viewport","PointsMaterial","MathUtils","addColorStop","setFromCamera","from","setSize","setPixelRatio","getPoints","warn","createRadialGradient","min","innerHTML","rgb(255,192,215)","random","shadowColor","createElement","Không tìm thấy dữ liệu trong link. Sử dụng dữ liệu mặc định.","DynamicDrawUsage","spawnInterval","clearDepth","fillText","textAlign","copy","shadowBlur","updateProjectionMatrix","replace","2224160aelhtN","arc","onBeforeCompile","clearRect","data","100%","uniform float size;","SHOOT","parent","Hệ thống đang cập nhật","isActive","all","attribute float size; attribute float alpha; varying float vAlpha;","location","100vh","rgba(20, 20, 20, 0.97)","SpriteMaterial","set","#ff40c8","innerWidth","find","BufferGeometry","bold 48px Arial, sans-serif","PlaneGeometry","moveTo","setHSL","get","minFilter","getElapsedTime","position","test","music","parse",'300 70.4px "Mali","Comfortaa","Segoe UI Emoji","Noto Color Emoji","Apple Color Emoji",sans-serif',"block","CylinderGeometry",'"></i>',"Clock","void main() {","remove","split","content","enableZoom","aspect","map","then","fill","has","#ff69b4","lineWidth","65857JXalwj","4Tksulf","Sprite","shift","Tự động phát bị chặn.","TextureLoader","BufferAttribute","AdditiveBlending","8miZLrK","max","center","querySelector","Image config:"];return(_0x28ae=function(){return t})()}console[_0x271749(391)](_0x271749(320),IMAGE_CONFIG);const useCustomColor=appData[_0x271749(434)]&&/^#([A-Fa-f0-9]{8}|[A-Fa-f0-9]{6})$/[_0x271749(288)](appData[_0x271749(434)]),heartInitialColor=new(_0x3d167c[_0x271749(337)])(useCustomColor?appData.heartColor:_0x271749(306));let imageTextures=[],imageLoadingComplete=!1,imagePool=[],activeImages=new Map,freeImageIndices=[],currentImageIndex=0,lastImageSpawnTime=0,imageSpawnQueue=[],minActiveImages=8,maxConcurrentImages=24,lastStatusLogTime=0,independentImageSprites=[],nextIndependentSpawnTime=0;const textureLoader=new(_0x3d167c[_0x271749(313)]);async function fetchAndPrepareImageTextures(){const t=_0x271749;try{const e=IMAGE_CONFIG[t(334)].map((e=>new Promise(((o,a)=>{const s=t;textureLoader[s(421)](e,(t=>{const e=s;t[e(285)]=_0x3d167c[e(325)],t.magFilter=_0x3d167c[e(325)],t[e(454)]=_0x3d167c.RGBAFormat,t[e(367)]=!0,o(t)}),void 0,(t=>{const e=s,a=document[e(247)]("canvas");a[e(399)]=a[e(457)]=512;const r=a.getContext("2d"),n=r[e(241)](256,256,0,256,256,256);n.addColorStop(0,e(406)),n[e(234)](1,e(344)),r[e(388)]=n,r[e(425)](0,0,512,512);const i=new(_0x3d167c[e(350)])(a);i[e(367)]=!0,o(i)}))}))));return imageTextures=await Promise[t(269)](e),!0}catch(t){return!1}}function buildImageSpriteMaterial(t,e=1){return new _0x3d167c.SpriteMaterial({map:t,transparent:!0,opacity:e,depthWrite:!1,alphaTest:.1,sizeAttenuation:!0})}function getAspectRatioAdjustedScale(t,e=2.5){const o=_0x271749;if(!t||!t[o(207)])return e;const a=t[o(207)][o(399)]/t[o(207)][o(457)];return{x:a>1?e:e*a,y:a>1?e/a:e}}async function setupImageStreaming(){imageLoadingComplete=await fetchAndPrepareImageTextures(),imageLoadingComplete&&tweakSpawnParametersByImageCount()}function tweakSpawnParametersByImageCount(){const t=_0x271749,e=IMAGE_CONFIG[t(423)];e<=2?(IMAGE_CONFIG.spawnInterval=300,minActiveImages=6,maxConcurrentImages=Math[t(242)](15,7.5*e)):e<=5?(IMAGE_CONFIG[t(250)]=400,minActiveImages=8,maxConcurrentImages=Math[t(242)](18,3.5*e)):(IMAGE_CONFIG[t(250)]=500,minActiveImages=8,maxConcurrentImages=Math.min(30,Math[t(228)](2.5*e)))}function printImageSystemReport(){const t=_0x271749;activeImages[t(215)],independentImageSprites[t(433)],freeImageIndices[t(433)],imageSpawnQueue[t(433)]}function setupImageObjectPool(){const t=_0x271749;if(imageLoadingComplete&&streamHeart){imagePool[t(419)]((e=>{const o=t;e&&e.parent&&e[o(266)][o(297)](e)})),imagePool.length=0,activeImages[t(341)](),freeImageIndices.length=0;for(let e=0;e<IMAGE_CONFIG.maxActiveImages;e++){const o=e%IMAGE_CONFIG[t(423)],a=imageTextures[o],s=buildImageSpriteMaterial(a,1),r=new(_0x3d167c[t(310)])(s),n=getAspectRatioAdjustedScale(a,IMAGE_CONFIG[t(466)]);r[t(466)][t(275)](n.x,n.y,1),r[t(442)]=!1,r[t(340)]={poolIndex:e,textureIndex:o,isActive:!1,particleIndex:-1,aspectScale:n},streamHeart[t(398)](r),imagePool[t(323)](r),freeImageIndices[t(323)](e)}}}function retrieveImageFromPool(t){const e=_0x271749;if(0===freeImageIndices[e(433)])return null;const o=freeImageIndices.pop(),a=imagePool[o],s=currentImageIndex%IMAGE_CONFIG.count,r=imageTextures[s];a.material[e(302)]=r,a.material[e(367)]=!0;const n=getAspectRatioAdjustedScale(r,IMAGE_CONFIG.scale);return a[e(466)][e(275)](n.x,n.y,1),a[e(340)]={...a.userData,aspectScale:n,textureIndex:s,isActive:!0,particleIndex:t},activeImages[e(275)](t,o),currentImageIndex=(currentImageIndex+1)%IMAGE_CONFIG.count,a}function releaseImageToPool(t){const e=_0x271749,o=activeImages[e(284)](t);if(void 0!==o){const a=imagePool[o];a[e(442)]=!1,a.material[e(373)]=0,a[e(340)][e(268)]=!1,a.userData[e(478)]=-1,activeImages[e(382)](t),freeImageIndices[e(323)](o)}}function controlImageSpawningLogic(t){const e=_0x271749,o=activeImages[e(215)]+independentImageSprites[e(433)],a=o<minActiveImages,s=t-lastImageSpawnTime>=IMAGE_CONFIG[e(250)]&&o<maxConcurrentImages;if(!a&&!s)return;(a||t>=nextIndependentSpawnTime)&&createFloatingImageSprite(t);let r=selectBestParticleForImageSpawn();-1!==r&&freeImageIndices[e(433)]>0&&(imageSpawnQueue[e(323)]({particleIndex:r,imageIndex:currentImageIndex%IMAGE_CONFIG.count,spawnTime:t,isForced:a}),currentImageIndex=(currentImageIndex+1)%IMAGE_CONFIG[e(423)],lastImageSpawnTime=t)}function createFloatingImageSprite(t){const e=_0x271749,o=Math[e(228)](.8*maxConcurrentImages);if(independentImageSprites[e(433)]>=o)return;const a=currentImageIndex%IMAGE_CONFIG[e(423)],s=imageTextures[a],r=buildImageSpriteMaterial(s,1),n=new(_0x3d167c[e(310)])(r),i=getAspectRatioAdjustedScale(s,IMAGE_CONFIG[e(466)]);n.scale.set(i.x,i.y,1),n[e(442)]=!1,n[e(340)]={isIndependent:!0,imageIndex:a,spawnTime:t,lifeDuration:6e3+2e3*Math[e(245)](),startY:planeYCenter,startX:0,startZ:0,aspectScale:i},streamHeart.add(n),independentImageSprites[e(323)](n),currentImageIndex=(currentImageIndex+1)%IMAGE_CONFIG[e(423)],lastImageSpawnTime=t,nextIndependentSpawnTime=t+1.2*IMAGE_CONFIG[e(250)]}function animateFloatingImageSprites(t){const e=_0x271749;for(let o=independentImageSprites[e(433)]-1;o>=0;o--){const a=independentImageSprites[o],s=a[e(340)],r=(t-s.spawnTime)/s[e(330)];if(r>=1){streamHeart.remove(a),independentImageSprites[e(360)](o,1);continue}a[e(442)]=!0;const n=1-Math[e(370)](1-r,2),i=planeYCenter,c=10+4*Math[e(364)](r*Math.PI*2),l=_0x3d167c[e(233)].lerp(i,c,n),x=1.5+s[e(336)]%5*.3,m=s.imageIndex%2==0?1:-1,_=r*x*Math.PI*2*m,d=(1-n)*(6+3*Math[e(364)](s.imageIndex)),p=Math.cos(_)*d,h=Math.sin(_)*d;if(a[e(287)][e(275)](p,l,h),r<.1){a.material[e(373)]=r/.1;const t=s.aspectScale||{x:IMAGE_CONFIG[e(466)],y:IMAGE_CONFIG[e(466)]};a.scale[e(275)](t.x*(.5+5*r),t.y*(.5+5*r),1)}else if(r>.4){const t=(r-.4)/.6;a.material[e(373)]=1-t;const o=1-.9*t,s=a.userData[e(452)]||{x:IMAGE_CONFIG.scale,y:IMAGE_CONFIG[e(466)]};a.scale[e(275)](s.x*o,s.y*o,1),t>.9&&(a[e(442)]=!1)}else{a.material[e(373)]=1;const t=s.aspectScale||{x:IMAGE_CONFIG[e(466)],y:IMAGE_CONFIG[e(466)]};a[e(466)][e(275)](t.x,t.y,1)}}}function selectBestParticleForImageSpawn(){const t=_0x271749,e=[];for(let o=0;o<streamCount;o++)if(!activeImages.has(o)){const a=streamState[o];e[t(323)]({index:o,state:a,priority:a===STATE_ASCEND?3:a===STATE_ON_DISK?2:1})}return 0===e[t(433)]?-1:(e.sort(((e,o)=>o[t(403)]-e[t(403)])),e[0][t(379)])}function handleQueuedImageSpawns(){const t=_0x271749;for(;imageSpawnQueue.length>0;){const{particleIndex:e,imageIndex:o}=imageSpawnQueue[t(311)]();!activeImages[t(305)](e)&&freeImageIndices[t(433)]>0&&retrieveImageFromPool(e)}}function applyMobileSpecificSettings(){const t=_0x271749;if(!document[t(319)]('meta[name="viewport"]')){const e=document[t(247)]("meta");e.name=t(231),e[t(299)]=t(361),document[t(474)][t(366)](e)}document[t(328)][t(194)].overflow="hidden",document.body[t(194)].position=t(470),document[t(328)].style[t(399)]=t(263),document.body[t(194)][t(457)]=t(263);/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator[t(349)])&&renderer[t(238)](Math[t(242)](window.devicePixelRatio,2))}setupImageStreaming();let STAR_COUNT=0,starAlpha=null,starPhase=null,starGeo=null;const RingText=[...appData[_0x271749(461)]];let cameraAnimationStart=null;const CAMERA_ANIMATION_DURATION=2.5;let CAMERA_START_POSITION={x:0,y:90,z:30};const CAMERA_END_POSITION={x:0,y:25,z:65};let userHasMovedCamera=!1,streamHeartStarted=!1,streamHeartActiveRatio=0,firstResetCompleted=!1;const scene=new(_0x3d167c[_0x271749(456)]),heartScene=new(_0x3d167c[_0x271749(456)]),renderer=new(_0x3d167c[_0x271749(430)])({antialias:!0,alpha:!0}),HEART_ROTATE=!1;let heartbeatEnabled=!1;const fadeObjects=[],explosionEffects=[],effectPool={waves:[],sparkles:[],texts:[]},POOL_SIZE=5,activeTexts=new Map;let isPulsing=!1,pulseStartTime=0;const PULSE_DURATION=.6,PULSE_AMPLITUDE=.15;let revealStart=null;const REVEAL_DURATION=1.5,HEARTBEAT_FREQ_HZ=.5,HEARTBEAT_AMPLITUDE=.05,STAGE={RIBBON:0,STREAM:1,STAR:2,SHOOT:3,HEART:4},STAGE_DURATION=.15;renderer[_0x271749(238)](window[_0x271749(464)]),renderer[_0x271749(237)](window[_0x271749(277)],window.innerHeight),document[_0x271749(328)].appendChild(renderer[_0x271749(327)]),applyMobileSpecificSettings();let staticBottomHeart=null,staticTopHeart=null;const camera=new _0x3d167c.PerspectiveCamera(45,window[_0x271749(277)]/window[_0x271749(227)],.1,300);camera.position[_0x271749(275)](0,90,25),camera.lookAt(0,0,0);const controls=new OrbitControls(camera,renderer[_0x271749(327)]);controls.enableDamping=!0,controls[_0x271749(438)]=5,controls[_0x271749(431)]=100,controls[_0x271749(300)]=!0,controls.minPolarAngle=_0x3d167c[_0x271749(233)][_0x271749(390)](60),controls.maxPolarAngle=_0x3d167c[_0x271749(233)][_0x271749(390)](135),controls[_0x271749(386)]=!0;const planeGeo1=new(_0x3d167c[_0x271749(281)])(30,30),planeMat=new(_0x3d167c[_0x271749(346)])({color:16711935,side:_0x3d167c[_0x271749(352)],visible:!1}),invisiblePlane=new(_0x3d167c[_0x271749(363)])(planeGeo1,planeMat);invisiblePlane[_0x271749(439)].z=Math.PI,invisiblePlane[_0x271749(287)].y=10,scene[_0x271749(398)](invisiblePlane);const composerMain=new EffectComposer(renderer),renderPassMain=new RenderPass(scene,camera);renderPassMain[_0x271749(341)]=!1,composerMain[_0x271749(199)](renderPassMain);const composerHeart=new EffectComposer(renderer);composerHeart[_0x271749(199)](new RenderPass(heartScene,camera));const afterimagePass=new AfterimagePass;afterimagePass[_0x271749(197)][_0x271749(416)][_0x271749(420)]=.9,composerHeart[_0x271749(199)](afterimagePass),scene[_0x271749(398)](new _0x3d167c.AmbientLight(16777215,.6));const p1=new(_0x3d167c[_0x271749(331)])(16777215,1.2);p1[_0x271749(287)][_0x271749(275)](10,10,10),scene[_0x271749(398)](p1);const p2=new(_0x3d167c[_0x271749(331)])(16738047,.8);function generateGlowCircleTexture(){const t=_0x271749,e=document[t(247)](t(443));e[t(399)]=256,e.height=256;const o=e[t(369)]("2d"),a=128,s=o[t(241)](a,a,.4*127,a,a,127);s.addColorStop(0,"rgba(255,105,180,0.6)"),s[t(234)](1,t(397)),o[t(388)]=s,o[t(348)](),o[t(259)](a,a,127,0,2*Math.PI),o[t(429)](),o[t(304)]();const r=o.createRadialGradient(a,a,0,a,a,76.2);r[t(234)](0,"rgba(255,255,255,1)"),r.addColorStop(1,"rgba(255,255,255,0)"),o.fillStyle=r,o.beginPath(),o[t(259)](a,a,76.2,0,2*Math.PI),o[t(429)](),o[t(304)]();const n=new(_0x3d167c[t(350)])(e);return n[t(285)]=_0x3d167c.LinearFilter,n[t(465)]=_0x3d167c[t(325)],n[t(367)]=!0,n}p2.position[_0x271749(275)](-10,-10,-10),scene[_0x271749(398)](p2);const circleTexture=generateGlowCircleTexture(),heartShape=new _0x3d167c.Shape,x=0,y=0;heartShape[_0x271749(282)](5,5),heartShape[_0x271749(376)](5,5,4,0,0,0),heartShape[_0x271749(376)](-6,0,-6,7,-6,7),heartShape[_0x271749(376)](-6,11,-3,15.4,5,19),heartShape[_0x271749(376)](12,15.4,16,11,16,7),heartShape[_0x271749(376)](16,7,16,0,10,0),heartShape[_0x271749(376)](7,0,5,5,5,5);const polyPts=heartShape[_0x271749(239)](100);function isPointInsidePolygon(t,e){let o=!1;for(let a=0,s=e[_0x271749(433)]-1;a<e.length;s=a++){const r=e[a].x,n=e[a].y,i=e[s].x,c=e[s].y;n>t.y!=c>t.y&&t.x<(i-r)*(t.y-n)/(c-n)+r&&(o=!o)}return o}const polyShift=polyPts[_0x271749(302)]((t=>({x:t.x-5,y:t.y-7}))),BORDER_THRESHOLD=.1*(Math[_0x271749(317)](...polyPts[_0x271749(302)]((t=>t.x)))-Math[_0x271749(242)](...polyPts[_0x271749(302)]((t=>t.x))));function calculateMinimumDistanceToBorder(t,e){const o=_0x271749;let a=1/0;for(let s=0;s<polyShift.length;s++){const r=polyShift[s],n=polyShift[(s+1)%polyShift[o(433)]],i=n.x-r.x,c=n.y-r.y,l=((t-r.x)*i+(e-r.y)*c)/(i*i+c*c),x=Math[o(317)](0,Math.min(1,l)),m=(t-(r.x+x*i))**2+(e-(r.y+x*c))**2;m<a&&(a=m)}return Math[o(408)](a)}const raycaster=new _0x3d167c.Raycaster,mouse=new(_0x3d167c[_0x271749(223)]),HEART_CENTER_TARGET=new(_0x3d167c[_0x271749(467)])(0,10,0);function createHeartExplosion(t){const e=_0x271749;mouse.x=t.clientX/window[e(277)]*2-1,mouse.y=-t[e(225)]/window[e(227)]*2+1,raycaster[e(235)](mouse,camera);const o=new(_0x3d167c[e(467)]);raycaster[e(224)].at(explosionDistance,o);const a=new(_0x3d167c[e(422)]),s=makeMat({map:circleTexture,blending:_0x3d167c.AdditiveBlending,depthWrite:!1,alphaSupport:!0,vertexColors:!0}),r=30+20*Math[e(245)](),n=[],i=[],c=[],l=[],x=(new(_0x3d167c[e(337)]))[e(283)](Math.random(),.9,.7);for(let t=0;t<r;t++){n[e(323)](o.x,o.y,o.z);const t=x[e(393)]()[e(428)](.2*Math[e(245)]()-.1,0,0);i.push(t.r,t.g,t.b),c[e(323)](.8*Math[e(245)]()+.2);const a=Math[e(245)]()*Math.PI*2,s=Math[e(404)](2*Math[e(245)]()-1),r=15*Math[e(245)]()+10,m=new(_0x3d167c[e(467)]);m[e(426)](1,a,s),l[e(323)](m[e(358)](r))}const m=new(_0x3d167c[e(279)]);m[e(445)](e(287),new(_0x3d167c[e(394)])(n,3)),m[e(445)](e(483),new(_0x3d167c[e(394)])(i,3)),m[e(445)](e(215),new _0x3d167c.Float32BufferAttribute(c,1));const _=new _0x3d167c.Points(m,s);a[e(398)](_),a.userData[e(230)]=l,a.userData[e(198)]=1,scene[e(398)](a),explosionEffects[e(323)](a)}function setupEffectPools(){const t=_0x271749,e=document[t(247)](t(443));e[t(399)]=256,e[t(457)]=256;const o=e[t(369)]("2d"),a=o.createRadialGradient(128,128,0,128,128,128);a[t(234)](0,t(378)),a[t(234)](.3,t(375)),a.addColorStop(1,t(417)),o[t(388)]=a,o.fillRect(0,0,256,256);const s=new(_0x3d167c[t(350)])(e);for(let e=0;e<5;e++){const e=new(_0x3d167c[t(346)])({map:s,blending:_0x3d167c[t(315)],transparent:!0,depthWrite:!1}),o=new(_0x3d167c[t(363)])(new(_0x3d167c[t(281)])(20,20),e);o[t(442)]=!1,o[t(340)][t(472)]=!1,scene[t(398)](o),effectPool.waves[t(323)](o);const a=100,r=new(_0x3d167c[t(279)]);r[t(445)](t(287),new(_0x3d167c[t(314)])(new Float32Array(3*a),3)[t(453)](_0x3d167c[t(249)]));const n=makeMat({map:circleTexture,blending:_0x3d167c[t(315)],alphaSupport:!0,depthWrite:!1}),i=new(_0x3d167c[t(208)])(r,n);i[t(442)]=!1,i[t(340)][t(472)]=!1,scene[t(398)](i),effectPool[t(362)][t(323)](i)}const r=appData?.[t(461)]||[],n=(appData?.messages||[])[t(441)](" ")[t(298)](" ");[...new Set(n[t(356)]((e=>e[t(433)]>0)))][t(419)]((e=>{const o=t,a=createFlyingTextTexture(e),s=new(_0x3d167c[o(274)])({map:a,transparent:!0,depthWrite:!1,blending:_0x3d167c.AdditiveBlending}),r=new(_0x3d167c[o(310)])(s),n=a[o(207)][o(399)]/a[o(207)][o(457)];r.scale[o(275)](1.5*n,1.5,1),r[o(442)]=!1,r[o(340)][o(472)]=!1,r[o(340)].text=e,streamHeart.add(r),effectPool[o(381)][o(323)](r)})),r[t(419)]((e=>{const o=t,a=createFlyingTextTexture(e),s=new _0x3d167c.SpriteMaterial({map:a,transparent:!0,depthWrite:!1,blending:_0x3d167c[o(315)]}),r=new(_0x3d167c[o(310)])(s),n=a[o(207)][o(399)]/a[o(207)][o(457)];r.scale.set(2*n,2,1),r[o(442)]=!1,r[o(340)][o(472)]=!1,streamHeart.add(r),effectPool[o(381)][o(323)](r)}))}function releaseTextToPool(t){const e=_0x271749;if(activeTexts[e(305)](t)){const o=activeTexts[e(284)](t);o[e(442)]=!1,o[e(340)][e(472)]=!1,activeTexts.delete(t)}}function createFlyingTextTexture(t){const e=_0x271749,o=document[e(247)]("canvas");o.width=1024,o[e(457)]=128;const a=o[e(369)]("2d");a[e(481)]='bold 70px "Mali", sans-serif',a.textAlign=e(318),a[e(355)]=e(435),a[e(384)]=e(203),a.lineWidth=8,a.strokeText(t,o.width/2,o[e(457)]/2),a[e(388)]=e(477),a[e(252)](t,o.width/2,o[e(457)]/2);const s=new(_0x3d167c[e(350)])(o);return s[e(285)]=_0x3d167c[e(325)],s[e(465)]=_0x3d167c.LinearFilter,s}const positions=[],sampleCount=7e3,xs=polyPts.map((t=>t.x)),ys=polyPts.map((t=>t.y)),minX=Math.min(...xs),maxX=Math.max(...xs),minY=Math.min(...ys),maxY=Math[_0x271749(317)](...ys),threshold=minY+(maxY-minY)/6;for(;positions[_0x271749(433)]/3<7e3;){const t=Math[_0x271749(245)]()*(maxX-minX)+minX,e=Math[_0x271749(245)]()*(maxY-minY)+minY;if(isPointInsidePolygon({x:t,y:e},polyPts)){let o=1/0;for(let a=0;a<polyPts.length;a++){const s=polyPts[a],r=polyPts[(a+1)%polyPts.length],n=r.x-s.x,i=r.y-s.y,c=((t-s.x)*n+(e-s.y)*i)/(n*n+i*i),l=Math[_0x271749(317)](0,Math[_0x271749(242)](1,c)),x=t-(s.x+l*n),m=e-(s.y+l*i),_=x*x+m*m;_<o&&(o=_)}const a=1/(1+2*Math[_0x271749(408)](o));if(Math.random()<a){const o=3.6*(Math[_0x271749(245)]()-.5);positions.push(t-5,e-7,o)}}}let minZ=1/0,maxZval=-1/0;for(let t=2;t<positions[_0x271749(433)];t+=3){const e=positions[t];e<minZ&&(minZ=e),e>maxZval&&(maxZval=e)}const heartDepth=maxZval-minZ,heartWidth=maxX-minX,planeXVar=2*heartWidth,rStreamStart=.8*heartWidth,Rmax=rStreamStart,rVortex=.6*heartWidth,planeZVar=15*heartDepth,planeYCenter=maxY,planeYVar=1,riseDuration=10,fallDuration=0,holdDuration=0,STREAM_RISE_MIN=8,STREAM_RISE_MAX=12,INDENT_Y=maxY-.25*(maxY-minY),INDENT_HALF_WIDTH=.35*heartWidth,COS_ANGLE_THRESH=.707106,CLIP_FRONT_Z=.3,staticGeo=new _0x3d167c.BufferGeometry,originalPositions=positions.slice();staticGeo.setAttribute(_0x271749(287),new(_0x3d167c[_0x271749(394)])(originalPositions,3));const colors=[];for(let t=0;t<positions.length;t+=3)colors[_0x271749(323)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b);staticGeo[_0x271749(445)](_0x271749(483),new(_0x3d167c[_0x271749(394)])(colors,3));const staticSizes=new Float32Array(positions.length/3),SIZE_SCALE=2;for(let t=0;t<staticSizes[_0x271749(433)];t++)staticSizes[t]=2*(.3*Math[_0x271749(245)]()+.2);staticGeo[_0x271749(445)](_0x271749(215),new(_0x3d167c[_0x271749(394)])(staticSizes,1));const topIndices=[];for(let t=0;t<positions[_0x271749(433)];t+=3)positions[t+1]>threshold+.1*(Math[_0x271749(245)]()-.5)*(maxY-minY)&&topIndices[_0x271749(323)](t/3);const topSet=new Set(topIndices);let bottomPositions=[];const bottomColors=[],bottomSizes=[],bottomSizesBase=[],topPositionsArr=[],topColors=[],topSizes=[],topAlpha=[],idxToTopIdx=new Int32Array(positions[_0x271749(433)]/3).fill(-1);for(let t=0,e=0;t<positions[_0x271749(433)];t+=3){const o=t/3,a=staticSizes[o],s=positions[t],r=positions[t+1],n=positions[t+2];if(topSet[_0x271749(305)](o)){topPositionsArr[_0x271749(323)](s,r,n),topColors[_0x271749(323)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),topSizes[_0x271749(323)](a);const t=Math[_0x271749(343)](s)<INDENT_HALF_WIDTH&&r>INDENT_Y;topAlpha[_0x271749(323)](t?0:1),idxToTopIdx[o]=e++}else bottomPositions[_0x271749(323)](s,r,n),bottomColors[_0x271749(323)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),bottomSizes[_0x271749(323)](a)}staticGeo[_0x271749(445)]("position",new(_0x3d167c[_0x271749(394)])(topPositionsArr,3)),staticGeo[_0x271749(445)](_0x271749(483),new _0x3d167c.Float32BufferAttribute(topColors,3)),staticGeo[_0x271749(445)](_0x271749(215),new(_0x3d167c[_0x271749(394)])(topSizes,1)),staticGeo[_0x271749(445)](_0x271749(380),new(_0x3d167c[_0x271749(314)])(new Float32Array(topAlpha),1)),staticGeo[_0x271749(368)][_0x271749(287)][_0x271749(367)]=!0,staticGeo[_0x271749(368)][_0x271749(380)][_0x271749(367)]=!0;const topCount=topPositionsArr.length/3,topRadiusArr=new Float32Array(topCount),topPhaseArr=new Float32Array(topCount),topDelayArr=new Float32Array(topCount);for(let t=0;t<topCount;t++){const e=topPositionsArr[3*t],o=topPositionsArr[3*t+2],a=Math[_0x271749(408)](e*e+o*o);topRadiusArr[t]=a,topPhaseArr[t]=Math[_0x271749(226)](o,e),topDelayArr[t]=10*Math[_0x271749(245)]()}const GLOBAL_SPIRAL_FREQ=.5,BASE_OMEGA=-1*Math.PI/10,GATHER_RATIO=.01,HOLD_RATIO=.2,radiusPow=2.5,rCore=.25,rOuter=rVortex,vIn=.9,SHRINK_TO_CORE=!1,BURST_SPREAD=.1,FADE_DURATION=1.5,SPAWN_DELAY_MAX=3,ASCEND_DELAY_MAX=10,apexY=maxY,LOW_REGION_FACTOR=.5;let minBottomY=1/0,maxBottomY=-1/0;for(let t=1;t<bottomPositions[_0x271749(433)];t+=3){const e=bottomPositions[t];e<minBottomY&&(minBottomY=e),e>maxBottomY&&(maxBottomY=e)}const Y_THRESHOLD=minBottomY+.5*(maxBottomY-minBottomY),HIGH_BOTTOM_MULT=2;function _0x5930(t,e){const o=_0x28ae();return(_0x5930=function(t,e){return o[t-=194]})(t,e)}{const t=[],e=[],o=[];for(let a=0;a<bottomPositions.length;a+=3){const s=bottomPositions[a+1];if(s>=Y_THRESHOLD)for(let r=1;r<2;r++)t[_0x271749(323)](bottomPositions[a],s,bottomPositions[a+2]),e[_0x271749(323)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),o[_0x271749(323)](bottomSizes[a/3])}bottomPositions[_0x271749(323)](...t),bottomColors[_0x271749(323)](...e),bottomSizes[_0x271749(323)](...o)}const BOTTOM_ROTATE_RATIO=.2,rotPos=[],rotColors=[],rotSizes=[],staticBotPos=[],staticBotColors=[],staticBotSizes=[];for(let t=0;t<bottomPositions.length;t+=3)Math[_0x271749(245)]()<.2?(rotPos[_0x271749(323)](bottomPositions[t],bottomPositions[t+1],bottomPositions[t+2]),rotColors[_0x271749(323)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),rotSizes[_0x271749(323)](bottomSizes[t/3])):(staticBotPos.push(bottomPositions[t],bottomPositions[t+1],bottomPositions[t+2]),staticBotColors.push(heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),staticBotSizes[_0x271749(323)](bottomSizes[t/3]));bottomPositions[_0x271749(433)]=0,bottomPositions.push(...rotPos),bottomColors[_0x271749(433)]=0,bottomColors.push(...rotColors),bottomSizes.length=0,bottomSizes.push(...rotSizes);const bottomCount=bottomPositions[_0x271749(433)]/3,bottomRadiusArr=new Float32Array(bottomCount),bottomPhaseArr=new Float32Array(bottomCount),bottomDelayArr=new Float32Array(bottomCount),CLEFT_FACTOR=2.5,bottomAlphaArr=new Float32Array(bottomCount)[_0x271749(304)](1),bottomIsLow=new Uint8Array(bottomCount),pivotOffset=.25*heartWidth,KEEP_LOW_MIN=0,KEEP_LOW_MAX=.3;for(let t=0;t<bottomCount;t++){const e=bottomPositions[3*t],o=bottomPositions[3*t+1],a=bottomPositions[3*t+2],s=o<Y_THRESHOLD;if(bottomIsLow[t]=s?1:0,s){const e=0+(o-minBottomY)/(Y_THRESHOLD-minBottomY)*.3;bottomAlphaArr[t]=Math[_0x271749(245)]()<e?1:0}else bottomAlphaArr[t]=1;const r=Math[_0x271749(408)](e*e+a*a),n=Math.atan2(a,e),i=Math[_0x271749(242)](1,Math[_0x271749(343)](e)/(.25*heartWidth)),c=1.5*Math[_0x271749(370)](1-i,3)+1;bottomRadiusArr[t]=r*c,bottomPhaseArr[t]=n,bottomDelayArr[t]=10*Math[_0x271749(245)]()}const bottomAlphaBase=Float32Array[_0x271749(236)](bottomAlphaArr),bottomGeo=new(_0x3d167c[_0x271749(279)]);bottomGeo.setAttribute(_0x271749(287),new _0x3d167c.Float32BufferAttribute(bottomPositions,3)),bottomGeo[_0x271749(445)](_0x271749(483),new(_0x3d167c[_0x271749(394)])(bottomColors,3)[_0x271749(453)](_0x3d167c[_0x271749(249)])),bottomGeo[_0x271749(445)](_0x271749(215),new _0x3d167c.Float32BufferAttribute(bottomSizes,1)),bottomGeo[_0x271749(445)]("alpha",new(_0x3d167c[_0x271749(314)])(bottomAlphaArr,1));const V_SLOPE=.3,matBottom=makeMat({map:circleTexture,alphaSupport:!0,vClipSlope:.3,clipFrontZ:.3});matBottom[_0x271749(447)]=.5;const bottomHeart=new(_0x3d167c[_0x271749(208)])(bottomGeo,matBottom);bottomHeart.rotation.z=Math.PI,bottomHeart.renderOrder=0,scene[_0x271749(398)](bottomHeart);const BOTTOM_OMEGA=BASE_OMEGA,topPointVisibility=new Array(topIndices[_0x271749(433)])[_0x271749(304)](!0);let hiddenTopCount=0;const matStatic=makeMat({map:circleTexture,alphaSupport:!0});matStatic.alphaTest=.5;const staticHeart=new(_0x3d167c[_0x271749(208)])(staticGeo,matStatic);staticHeart[_0x271749(439)].z=Math.PI,staticHeart.renderOrder=0,scene.add(staticHeart);const TOP_STATIC_RATIO=.5;{const t=[],e=[],o=[];for(let a=0;a<topPositionsArr.length;a+=3){const s=calculateMinimumDistanceToBorder(topPositionsArr[a]+5,topPositionsArr[a+1]+7)<BORDER_THRESHOLD||Math[_0x271749(245)]()<.3;Math.random()<.5&&s&&(t[_0x271749(323)](topPositionsArr[a],topPositionsArr[a+1],topPositionsArr[a+2]),e[_0x271749(323)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),o[_0x271749(323)](topSizes[Math[_0x271749(222)](a/3)]))}if(t[_0x271749(433)]){const a=new(_0x3d167c[_0x271749(279)]);a[_0x271749(445)](_0x271749(287),new(_0x3d167c[_0x271749(394)])(t,3)),a[_0x271749(445)](_0x271749(483),new(_0x3d167c[_0x271749(394)])(e,3)[_0x271749(453)](_0x3d167c.DynamicDrawUsage)),a[_0x271749(445)](_0x271749(215),new(_0x3d167c[_0x271749(394)])(o,1));const s=makeMat({map:circleTexture,alphaSupport:!0});s[_0x271749(447)]=.5,staticTopHeart=new(_0x3d167c[_0x271749(208)])(a,s),staticTopHeart[_0x271749(439)].z=Math.PI,staticTopHeart.renderOrder=0,scene[_0x271749(398)](staticTopHeart)}}if(staticBotPos[_0x271749(433)]>0){const t=new(_0x3d167c[_0x271749(279)]);t.setAttribute(_0x271749(287),new _0x3d167c.Float32BufferAttribute(staticBotPos,3)),t[_0x271749(445)](_0x271749(483),new(_0x3d167c[_0x271749(394)])(staticBotColors,3)[_0x271749(453)](_0x3d167c[_0x271749(249)])),t[_0x271749(445)](_0x271749(215),new(_0x3d167c[_0x271749(394)])(staticBotSizes,1));const e=makeMat({map:circleTexture,alphaSupport:!0});e[_0x271749(447)]=.5,staticBottomHeart=new(_0x3d167c[_0x271749(208)])(t,e),staticBottomHeart[_0x271749(439)].z=Math.PI,staticBottomHeart[_0x271749(372)]=0,scene[_0x271749(398)](staticBottomHeart)}const SPAWN_MULT=.2,rimIndices=[];for(const t of topIndices)calculateMinimumDistanceToBorder(positions[3*t],positions[3*t+1])<BORDER_THRESHOLD&&rimIndices.push(t);const streamSource=rimIndices.length?rimIndices:topIndices,streamCount=Math[_0x271749(222)](.2*streamSource[_0x271749(433)]),targetIdxArr=new Uint32Array(streamCount);for(let t=0;t<streamCount;t++)targetIdxArr[t]=streamSource[t%streamSource[_0x271749(433)]];const planeIdxForStream=new Int32Array(streamCount)[_0x271749(304)](-1),streamPositions=new Float32Array(3*streamCount),streamGeo=new _0x3d167c.BufferGeometry,streamAlpha=new Float32Array(streamCount)[_0x271749(304)](1);streamGeo.setAttribute(_0x271749(380),new(_0x3d167c[_0x271749(314)])(streamAlpha,1)),streamGeo.setAttribute(_0x271749(287),new(_0x3d167c[_0x271749(314)])(streamPositions,3)[_0x271749(453)](_0x3d167c.DynamicDrawUsage));const streamColors=new Float32Array(3*streamCount);for(let t=0;t<streamCount;t++)streamColors[3*t]=heartInitialColor.r,streamColors[3*t+1]=heartInitialColor.g,streamColors[3*t+2]=heartInitialColor.b;streamGeo[_0x271749(445)]("color",new(_0x3d167c[_0x271749(314)])(streamColors,3));const streamSizes=new Float32Array(streamCount);for(let t=0;t<streamCount;t++)streamSizes[t]=2*(.3*Math[_0x271749(245)]()+.2+.1)*1;const streamSizeBase=streamSizes[_0x271749(427)](),BIG_RATIO=.1;for(let t=0;t<streamCount;t++)Math[_0x271749(245)]()<.1&&(streamSizes[t]*=1.5,streamColors[3*t]=heartInitialColor.r,streamColors[3*t+1]=heartInitialColor.g,streamColors[3*t+2]=heartInitialColor.b);streamGeo[_0x271749(445)](_0x271749(215),new(_0x3d167c[_0x271749(314)])(streamSizes,1));const matStream=makeMat({map:circleTexture,alphaSupport:!0,clipBandWidth:INDENT_HALF_WIDTH,clipFrontZ:.3});matStream[_0x271749(447)]=.5;const streamHeart=new(_0x3d167c[_0x271749(208)])(streamGeo,matStream);streamHeart.rotation.z=Math.PI,streamHeart.renderOrder=1,scene[_0x271749(398)](streamHeart),streamHeart.visible=!1,fadeObjects[_0x271749(323)](streamHeart),streamHeart.userData.fadeStage=STAGE.STREAM;const PLANE_COUNT=Math[_0x271749(222)](120*rVortex),planePositions=[],planeColors=[],planeSizes=[],planeAlphaArr=new Float32Array(PLANE_COUNT)[_0x271749(304)](1);for(let t=0;t<PLANE_COUNT;t++){const t=Math[_0x271749(245)]()*Math.PI*2,e=Math.sqrt(Math.random())*rVortex;planePositions.push(Math.cos(t)*e,planeYCenter-7.5,Math[_0x271749(364)](t)*e),planeColors[_0x271749(323)](heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),planeSizes[_0x271749(323)](1*Math[_0x271749(245)]()+.25)}const planeGeo=new(_0x3d167c[_0x271749(279)]);planeGeo.setAttribute(_0x271749(287),new(_0x3d167c[_0x271749(394)])(planePositions,3)),planeGeo.setAttribute(_0x271749(483),new(_0x3d167c[_0x271749(394)])(planeColors,3)),planeGeo.setAttribute("size",new(_0x3d167c[_0x271749(394)])(planeSizes,1)),planeGeo[_0x271749(445)](_0x271749(380),new _0x3d167c.BufferAttribute(planeAlphaArr,1));const matPlane=makeMat({map:circleTexture,alphaSupport:!0});matPlane.alphaTest=.5;const planeLayer=new(_0x3d167c[_0x271749(208)])(planeGeo,matPlane);planeLayer.rotation.z=Math.PI,scene.add(planeLayer),fadeObjects[_0x271749(323)](planeLayer),fadeObjects[_0x271749(213)](planeLayer)&&fadeObjects[_0x271749(360)](fadeObjects[_0x271749(385)](planeLayer),1),planeLayer[_0x271749(442)]=!0;const PLANE_COLOR_CYCLE=9,PLANE_COL_WHITE=new(_0x3d167c[_0x271749(337)])("rgb(255, 227, 249)"),PLANE_COL_LIGHT=new(_0x3d167c[_0x271749(337)])(_0x271749(244)),PLANE_COL_DARK=new(_0x3d167c[_0x271749(337)])(_0x271749(342));function createTextSpriteTexture(t){const e=_0x271749,o=document.createElement(e(443));o[e(399)]=o.height=128;const a=o[e(369)]("2d");a[e(388)]=e(440),a[e(425)](0,0,128,128),a.textAlign=e(318),a.textBaseline=e(435),a[e(481)]=e(291),a[e(307)]=7.68,a[e(384)]=e(203),a.strokeText(t,64,64),a.fillStyle="#ffffff",a[e(252)](t,64,64);const s=new(_0x3d167c[e(350)])(o);return s[e(285)]=s[e(465)]=_0x3d167c[e(325)],s}planeGeo[_0x271749(368)][_0x271749(483)].setUsage(_0x3d167c[_0x271749(249)]);const ringCharsFull=RingText[_0x271749(441)](""),ringChars=Array[_0x271749(236)](ringCharsFull),charMatMap={};function generateTextRingTexture(t){const e=_0x271749,o=document[e(247)](e(443));o.width=2048,o[e(457)]=256;const a=o[e(369)]("2d");a[e(388)]=e(440),a.fillRect(0,0,o[e(399)],o[e(457)]),a[e(481)]=e(471),a.textAlign=e(318),a.textBaseline="middle";const s=o.height/t[e(433)];t[e(419)](((t,r)=>{const n=e,i=(r+.5)*s;a[n(246)]=n(276),a[n(255)]=0,a.fillStyle="#ff40c8",a.fillText(t,o.width/2,i),a[n(255)]=0,a[n(384)]=n(203),a[n(307)]=3,a[n(217)](t,o[n(399)]/2,i),a[n(388)]=n(477),a.fillText(t,o[n(399)]/2,i)}));const r=new _0x3d167c.CanvasTexture(o);return r[e(367)]=!0,r}[...new Set(ringChars)].forEach((t=>{const e=_0x271749;charMatMap[t]=new(_0x3d167c[e(274)])({map:createTextSpriteTexture(t),transparent:!0,depthWrite:!1})}));const ringTexture=generateTextRingTexture(RingText),ringMat=new(_0x3d167c[_0x271749(346)])({map:ringTexture,transparent:!0,side:_0x3d167c[_0x271749(352)],depthWrite:!1,blending:_0x3d167c.AdditiveBlending}),RING_THICKNESS=3.5,RING_HUE_SPEED=.05,RING_FADE_DIST=1,RING_FADE_SPEED=2,ringHeight=.8,RING_Y_OFFSET=2*-planeYCenter-.5,ringGeo=new(_0x3d167c[_0x271749(293)])(rVortex,rVortex,1,128,1,!0),RING_SPACING=2,RING_START_RADIUS=rVortex,RING_END_RADIUS=.25,RING_COUNT=Math.ceil((RING_START_RADIUS-.25)/2),RING_FLIP_Y=Math.PI,ribbon=new _0x3d167c.Group;ribbon.position.set(0,planeYCenter+RING_Y_OFFSET,0),ribbon.rotation.z=Math.PI,scene[_0x271749(398)](ribbon),ribbon[_0x271749(442)]=!0;for(let t=0;t<RING_COUNT;t++){const e=generateTextRingTexture([RingText[t%RingText.length]]);e[_0x271749(411)]=_0x3d167c.RepeatWrapping,e[_0x271749(475)][_0x271749(275)](2,1),e[_0x271749(383)].x=1;const o=new(_0x3d167c[_0x271749(346)])({map:e,transparent:!0,side:_0x3d167c.DoubleSide,depthWrite:!1,blending:_0x3d167c.AdditiveBlending}),a=new(_0x3d167c[_0x271749(363)])(ringGeo,o);a[_0x271749(439)].x=Math.PI;const s=RING_START_RADIUS-2*t,r=2*(Math[_0x271749(245)]()-.5)*.3;a[_0x271749(340)][_0x271749(459)]=s+r,a[_0x271749(340)][_0x271749(221)]=Math[_0x271749(245)]()*Math.PI*2;const n=s/RING_START_RADIUS;a[_0x271749(466)][_0x271749(275)](n,3.5,n),a.material[_0x271749(373)]=1,a[_0x271749(468)][_0x271749(220)]=!0,a[_0x271749(468)][_0x271749(211)]=!1,a[_0x271749(372)]=t,ribbon[_0x271749(398)](a)}const vortexIndices=[];for(let t=0;t<positions.length/3;t++)topIndices[_0x271749(213)](t)||vortexIndices.push(t);const vortexCount=vortexIndices[_0x271749(433)],vortexPositions=new Float32Array(3*vortexCount),vortexPhase=new Float32Array(vortexCount),vortexRadius=new Float32Array(vortexCount);for(let t=0;t<vortexCount;t++){vortexPhase[t]=Math[_0x271749(245)]()*Math.PI*2;const e=Math[_0x271749(245)]()*rVortex;vortexRadius[t]=e,vortexPositions[3*t]=Math[_0x271749(219)](vortexPhase[t])*e,vortexPositions[3*t+1]=planeYCenter,vortexPositions[3*t+2]=Math[_0x271749(364)](vortexPhase[t])*e}const vortexGeo=new(_0x3d167c[_0x271749(279)]);vortexGeo[_0x271749(445)](_0x271749(287),new(_0x3d167c[_0x271749(314)])(vortexPositions,3).setUsage(_0x3d167c.DynamicDrawUsage));const vortexColors=new Float32Array(3*vortexCount);for(let t=0;t<vortexCount;t++)vortexColors[3*t]=heartInitialColor.r,vortexColors[3*t+1]=heartInitialColor.g,vortexColors[3*t+2]=heartInitialColor.b;vortexGeo[_0x271749(445)](_0x271749(483),new(_0x3d167c[_0x271749(314)])(vortexColors,3));const vortexSizes=new Float32Array(vortexCount);for(let t=0;t<vortexCount;t++)vortexSizes[t]=.2*Math.random()+.15;vortexGeo.setAttribute(_0x271749(215),new(_0x3d167c[_0x271749(314)])(vortexSizes,1));const vortexMat=makeMat({map:circleTexture,blending:_0x3d167c[_0x271749(315)],opacity:.8});vortexMat[_0x271749(260)]=function(t){const e=_0x271749;t[e(424)]=t[e(424)][e(257)](e(264),"attribute float size;")};const heartLayers=[staticHeart,bottomHeart,staticBottomHeart,staticTopHeart];heartLayers[_0x271749(419)]((t=>{const e=_0x271749;t&&(scene[e(297)](t),heartScene[e(398)](t))})),heartLayers[_0x271749(419)]((t=>{const e=_0x271749;t&&(t[e(442)]=!1,t[e(340)][e(402)]=STAGE[e(216)],fadeObjects[e(213)](t)||fadeObjects[e(323)](t))}));const HEART_OFFSET_Y=10;[staticHeart,bottomHeart,staticTopHeart,staticBottomHeart][_0x271749(419)]((t=>{t&&(t[_0x271749(287)].y+=10)}));const HEART_OFFSET_YY=8;[streamHeart,ribbon][_0x271749(419)]((t=>{t&&(t[_0x271749(287)].y+=8)}));const ENABLE_EXPLOSION=!1;let expPositions,expVelocities,expBirth,expGeo,expColors,expMat,explosionPoints,MAX_EXP,expCount=0;const startTimes=new Float32Array(streamCount),STATE_ON_DISK=0,STATE_ASCEND=1,streamState=new Uint8Array(streamCount),curRadiusArr=new Float32Array(streamCount),ascendStart=new Float32Array(streamCount),spiralPhase=new Float32Array(streamCount),streamRadius=new Float32Array(streamCount),initialRadius=new Float32Array(streamCount),spiralFrequency=new Float32Array(streamCount),spiralDirection=new Float32Array(streamCount),extraRotArr=new Float32Array(streamCount),MAX_TOP_HIDE=Math[_0x271749(222)](1*topIndices.length),HIDE_DISTANCE=.25,TOP_ROT_SPEED=.5,streamRiseDuration=new Float32Array(streamCount),streamOffsets=new Float32Array(3*streamCount);for(let t=0;t<streamCount;t++){const e=3*t,o=Math[_0x271749(245)]()*Math.PI*2,a=Math[_0x271749(404)](2*Math[_0x271749(245)]()-1),s=.4;streamOffsets[e]=s*Math[_0x271749(364)](a)*Math[_0x271749(219)](o),streamOffsets[e+1]=s*Math[_0x271749(364)](a)*Math[_0x271749(364)](o),streamOffsets[e+2]=s*Math.cos(a)}function initializeStreamParticleState(t,e){const o=_0x271749,a=3*t,s=targetIdxArr[t];let r=-1;for(let t=0;t<100;t++){const t=Math[o(222)](Math[o(245)]()*PLANE_COUNT),e=planePositions[3*t],a=planePositions[3*t+2];if(Math[o(359)](e,a)<=.26){r=t;break}}-1===r&&(r=Math[o(222)](Math[o(245)]()*PLANE_COUNT)),planeIdxForStream[t]=r;const n=Math[o(245)]()*Math.PI*2;planePositions[3*r]=Math[o(219)](n)*rOuter,planePositions[3*r+2]=Math.sin(n)*rOuter,planeGeo.attributes.position[o(367)]=!0;const i=planeLayer[o(439)].y,c=Math[o(219)](i),l=Math[o(364)](i),x=c*planePositions[3*r]-l*planePositions[3*r+2],m=l*planePositions[3*r]+c*planePositions[3*r+2];streamPositions[a]=x,streamPositions[a+1]=planePositions[3*r+1],streamPositions[a+2]=m;const _=.25+(rOuter-.25)*Math.random(),d=Math.random()*Math.PI*2;streamPositions[a]=Math[o(219)](d)*_,streamPositions[a+1]=planeYCenter,streamPositions[a+2]=Math[o(364)](d)*_,curRadiusArr[t]=_,spiralPhase[t]=d,streamState[t]=STATE_ON_DISK,startTimes[t]=e-Math[o(245)]()*(rOuter-.25)/.9,ascendStart[t]=10*Math[o(245)](),streamRiseDuration[t]=8+4*Math.random();const p=.5+1.5*Math[o(245)](),h=Math.random()<.5?-1:1;extraRotArr[t]=2*p*Math.PI*h;const u=idxToTopIdx[s];-1!==u&&(topAlpha[u]=1,staticGeo[o(368)][o(380)][o(367)]=!0),activeImages.has(t)&&releaseImageToPool(t),activeTexts[o(305)](t)&&releaseTextToPool(t),streamAlpha[t]=1,streamGeo.attributes.alpha.needsUpdate=!0}const now0=0;for(let t=0;t<streamCount;t++)initializeStreamParticleState(t,0);streamGeo[_0x271749(368)][_0x271749(287)][_0x271749(367)]=!0,streamGeo.attributes[_0x271749(380)][_0x271749(367)]=!0;const clock=new(_0x3d167c[_0x271749(295)]);let initialColorApplied=!1;function mainAnimationLoop(){const t=_0x271749;requestAnimationFrame(mainAnimationLoop);let e=clock[t(410)]();const o=clock.getElapsedTime();e>.1&&(e=.1);for(let l=0;l<PLANE_COUNT;l++){const x=3*l;let m=planePositions[x],_=planePositions[x+2],d=Math[t(359)](m,_);if(d>.25){d=Math[t(317)](.25,d-.9*e);const p=Math.atan2(_,m);planePositions[x]=Math[t(219)](p)*d,planePositions[x+2]=Math.sin(p)*d}}if(planeGeo.attributes[t(287)][t(367)]=!0,planeLayer[t(442)]&&(planeLayer[t(442)]=!0),planeLayer[t(439)].y=BASE_OMEGA*o,void 0!==ribbon&&(ribbon[t(439)].y=planeLayer[t(439)].y+RING_FLIP_Y),void 0!==ribbon&&ribbon.children[t(433)]){const h=RING_START_RADIUS-.25;ribbon[t(458)][t(419)](((o,a)=>{const s=t;o[s(340)][s(459)]-=.9*e,o.userData.radius-1.75<.25&&(o[s(340)][s(459)]+=h+2);const r=o[s(340)].radius-1.75;if(r<1.25){const t=_0x3d167c[s(233)].clamp((r-.25)/1,0,1);o[s(468)][s(373)]=t}r<.25&&(o[s(340)].radius+=h+2,o[s(468)][s(373)]=0),o[s(468)][s(373)]<1&&(o[s(468)][s(373)]=Math[s(242)](1,o[s(468)][s(373)]+2*e));const n=o[s(340)][s(459)]/RING_START_RADIUS;o[s(466)][s(275)](n,3.5,n),o[s(468)][s(483)].set(16777215),o[s(439)].y=o.userData[s(221)]}))}camera[t(437)]();const a=camera[t(389)];if(cosmicDust[t(439)].y+=15e-5,streamHeartStarted){streamHeart[t(338)],new(_0x3d167c[t(467)]),new(_0x3d167c[t(467)]);const u=1e3*o;controlImageSpawningLogic(u),handleQueuedImageSpawns(),animateFloatingImageSprites(u),u-lastStatusLogTime>3e3&&(printImageSystemReport(),lastStatusLogTime=u);for(let A=0;A<streamCount;A++){const I=3*A,S=startTimes[A],f=o-(S+A%5*1.6),T=targetIdxArr[A];if(streamState[A]===STATE_ON_DISK){const P=spiralPhase[A]+BASE_OMEGA*(o-startTimes[A]);streamPositions[I]=Math.cos(P)*curRadiusArr[A],streamPositions[I+1]=planeYCenter,streamPositions[I+2]=Math[t(364)](P)*curRadiusArr[A],activeImages[t(305)](A)&&releaseImageToPool(A),streamAlpha[A]=1,f>=ascendStart[A]&&(streamState[A]=STATE_ASCEND,startTimes[A]=o,initialRadius[A]=curRadiusArr[A]);continue}if(f<-1.5){const C=spiralPhase[A]+BASE_OMEGA*(o-S);streamPositions[I]=initialRadius[A]*Math[t(219)](C),streamPositions[I+1]=planeYCenter,streamPositions[I+2]=initialRadius[A]*Math[t(364)](C),streamAlpha[A]=0;continue}if(f<0){const w=(f+1.5)/1.5,b=w*w*(3-2*w);streamAlpha[A]=b,activeImages[t(305)](A)&&releaseImageToPool(A);const E=spiralPhase[A]+BASE_OMEGA*(o-S);streamPositions[I]=initialRadius[A]*Math[t(219)](E),streamPositions[I+1]=planeYCenter,streamPositions[I+2]=initialRadius[A]*Math[t(364)](E);continue}const g=streamRiseDuration[A];if(f>=g){const y=(f-g)/1.5;if(y<1){const O=y*y*(3-2*y);if(streamAlpha[A]=1-O,activeImages[t(305)](A)){const G=activeImages[t(284)](A);imagePool[G][t(468)].opacity*=1-O}const v=spiralPhase[A]+BASE_OMEGA*(o-S);streamPositions[I]=initialRadius[A]*Math[t(219)](v),streamPositions[I+1]=planeYCenter,streamPositions[I+2]=initialRadius[A]*Math[t(364)](v);continue}streamAlpha[A]=1,activeImages[t(305)](A)&&releaseImageToPool(A),initializeStreamParticleState(A,o),firstResetCompleted||(firstResetCompleted=!0);continue}streamAlpha[A]=1;const M=f/g;if(M<.01){let R,H,N;const D=spiralPhase[A]+BASE_OMEGA*(o-S);{const F=initialRadius[A];R=Math[t(219)](D)*F,N=Math.sin(D)*F;const L=Math.min(1,M/.01);H=_0x3d167c[t(233)].lerp(planeYCenter,apexY,L)}streamPositions[I]=R,streamPositions[I+1]=H,streamPositions[I+2]=N}else{const B=(M-.01)/.99,z=1-Math.pow(1-B,3),Y=spiralPhase[A]+BASE_OMEGA*(o-S),U=initialRadius[A],W=Math[t(219)](Y)*U,k=Math[t(364)](Y)*U,j=apexY,V=3*T,X=positions[V],Z=positions[V+1]-4+2,K=positions[V+2];let Q=_0x3d167c[t(233)][t(206)](W,X,z),q=_0x3d167c[t(233)][t(206)](j,Z,z),J=_0x3d167c[t(233)][t(206)](k,K,z);const $=1+.1*(1-z);Q*=$,J*=$;const tt=(1-z)*extraRotArr[A],et=Math[t(219)](tt),ot=Math[t(364)](tt),at=Q*et-J*ot,st=Q*ot+J*et;streamPositions[I]=at,streamPositions[I+1]=q,streamPositions[I+2]=st}if(M<.01)streamAlpha[A]=1,activeImages.has(A)&&releaseImageToPool(A);else{const rt=(M-.01)/.99;let nt=null;if(activeImages.has(A)){const it=activeImages[t(284)](A);nt=imagePool[it]}if(nt){streamAlpha[A]=0,nt[t(442)]=!0;const ct=1-Math[t(370)](1-rt,3),lt=3*T,xt=positions[lt],mt=positions[lt+1]-4+2,_t=positions[lt+2],dt=1+A%5*.2,pt=A%2==0?1:-1,ht=spiralPhase[A]+ct*dt*Math.PI*2*pt,ut=(1-ct)*(2+1*Math[t(364)](A)),At=_0x3d167c[t(233)].lerp(0,xt,ct),It=_0x3d167c.MathUtils.lerp(apexY,mt,ct),St=_0x3d167c[t(233)][t(206)](0,_t,ct),ft=At+Math[t(219)](ht)*ut,Tt=It,gt=St+Math[t(364)](ht)*ut;if(nt.position[t(275)](ft,Tt,gt),ct>.4){const Mt=(ct-.4)/.6,Pt=1;nt[t(468)][t(373)]=Pt*(1-Mt);const Ct=1-.9*Mt,wt=nt.userData[t(452)]||{x:IMAGE_CONFIG[t(466)],y:IMAGE_CONFIG[t(466)]};nt[t(466)].set(wt.x*Ct,wt.y*Ct,1),Mt>.9&&(nt[t(442)]=!1,releaseImageToPool(A))}else{nt[t(468)].opacity=1;const bt=nt[t(340)][t(452)]||{x:IMAGE_CONFIG[t(466)],y:IMAGE_CONFIG.scale};nt[t(466)].set(bt.x,bt.y,1)}}else streamAlpha[A]=1}if(streamGeo[t(368)][t(215)][t(367)]=!0,M>.95){const Et=topIndices[t(385)](T);if(topPointVisibility[Et]&&hiddenTopCount<MAX_TOP_HIDE){topPointVisibility[Et]=!1;const yt=idxToTopIdx[T];-1!==yt&&(topAlpha[yt]=0,staticGeo[t(368)][t(380)][t(367)]=!0),hiddenTopCount++}}}}else{for(let Ot=0;Ot<streamCount;Ot++){if(streamHeartActiveRatio<1&&Ot/streamCount>.1){const Rt=3*Ot,Ht=spiralPhase[Ot]+BASE_OMEGA*o;streamPositions[Rt]=Math.cos(Ht)*curRadiusArr[Ot],streamPositions[Rt+1]=planeYCenter,streamPositions[Rt+2]=Math[t(364)](Ht)*curRadiusArr[Ot],streamAlpha[Ot]=0;continue}if(!firstResetCompleted&&Ot/streamCount>1e-4){const Nt=3*Ot,Dt=spiralPhase[Ot]+BASE_OMEGA*o;streamPositions[Nt]=Math[t(219)](Dt)*curRadiusArr[Ot],streamPositions[Nt+1]=planeYCenter,streamPositions[Nt+2]=Math.sin(Dt)*curRadiusArr[Ot],streamAlpha[Ot]=0;continue}const vt=3*Ot,Gt=spiralPhase[Ot]+BASE_OMEGA*o;streamPositions[vt]=Math[t(219)](Gt)*curRadiusArr[Ot],streamPositions[vt+1]=planeYCenter,streamPositions[vt+2]=Math[t(364)](Gt)*curRadiusArr[Ot],streamAlpha[Ot]=0}streamGeo[t(368)][t(287)][t(367)]=!0,streamGeo.attributes[t(380)].needsUpdate=!0}streamGeo[t(368)].position[t(367)]=!0,streamGeo.attributes[t(380)].needsUpdate=!0;for(let Ft=0;Ft<vortexCount;Ft++){const Lt=3*Ft,Bt=1*Math.PI/10,zt=vortexRadius[Ft],Yt=o*Bt,Ut=.3*Math[t(364)](Yt+vortexPhase[Ft]),Wt=.2*Math[t(219)](.7*Yt+vortexPhase[Ft]),kt=Yt+vortexPhase[Ft]+Ut,jt=zt*(1+Wt);vortexPositions[Lt]=Math[t(219)](kt)*jt,vortexPositions[Lt+1]=planeYCenter+.5*Math[t(364)](Yt+vortexPhase[Ft]),vortexPositions[Lt+2]=Math[t(364)](kt)*jt}vortexGeo[t(368)].position[t(367)]=!0;const s=bottomGeo[t(368)].position[t(377)];for(let Vt=0;Vt<bottomCount;Vt++){if(o<bottomDelayArr[Vt])continue;const Xt=bottomPhaseArr[Vt],Zt=bottomRadiusArr[Vt],Kt=Math[t(219)](Xt)*Zt;if(Math.abs(Xt)<.25*Math.PI){const te=Math[t(242)](1,Math[t(343)](Kt)/(.25*heartWidth)),ee=1.5*Math[t(370)](1-te,3)+1,oe=Kt>=0?1:-1;s[3*Vt]=Kt+oe*(Math[t(343)](Kt)*(ee-1))}else s[3*Vt]=Kt;s[3*Vt+2]=Math.sin(Xt)*Zt;const Qt=s[3*Vt],qt=s[3*Vt+1],Jt=s[3*Vt+2],$t=new(_0x3d167c[t(467)])(Qt,qt,Jt).applyMatrix4(bottomHeart[t(338)]);(new(_0x3d167c[t(467)]))[t(254)]($t)[t(409)](a),bottomAlphaArr[Vt]=bottomAlphaBase[Vt]}bottomGeo[t(368)][t(287)][t(367)]=!0,bottomGeo[t(368)][t(380)][t(367)]=!0;const r=controls[t(354)]();if(staticHeart&&(staticHeart[t(439)].y=r),bottomHeart&&(bottomHeart[t(439)].y=r),staticBottomHeart&&(staticBottomHeart[t(439)].y=r),staticTopHeart&&(staticTopHeart[t(439)].y=r),heartbeatEnabled){const ae=1+.05*Math[t(364)](.5*o*Math.PI*2);staticHeart&&staticHeart[t(466)][t(275)](ae,ae,ae),bottomHeart&&bottomHeart[t(466)].set(ae,ae,ae),staticBottomHeart&&staticBottomHeart.scale.set(ae,ae,ae),staticTopHeart&&staticTopHeart[t(466)][t(275)](ae,ae,ae)}if(controls[t(413)](),renderer[t(341)](),composerHeart.render(),renderer[t(251)](),renderer[t(210)]=!1,composerMain.render(),renderer[t(210)]=!0,hiddenTopCount<MAX_TOP_HIDE){for(let se=0;se<5&&hiddenTopCount<MAX_TOP_HIDE;se++){const re=Math.floor(Math[t(245)]()*topIndices[t(433)]),ne=topIndices[re];if(topPointVisibility[re]){topPointVisibility[re]=!1;const ie=idxToTopIdx[ne];-1!==ie&&(topAlpha[ie]=0,hiddenTopCount++)}}staticGeo[t(368)][t(287)][t(367)]=!0,staticGeo[t(368)].alpha[t(367)]=!0}for(let ce=explosionEffects[t(433)]-1;ce>=0;ce--){const le=explosionEffects[ce];if(le[t(340)][t(198)]-=e,le[t(340)][t(198)]<=0)!isPulsing&&(isPulsing=!0,pulseStartTime=o,triggerCosmicRipple()),scene.remove(le),explosionEffects[t(360)](ce,1);else{const xe=le[t(458)][0],me=xe[t(392)].attributes[t(287)][t(377)],_e=le[t(340)][t(230)],de=.04;for(let pe=0;pe<_e.length;pe++){const he=3*pe,ue=new _0x3d167c.Vector3(me[he],me[he+1],me[he+2]),Ae=_e[pe],Ie=HEART_CENTER_TARGET[t(393)]().sub(ue);Ae[t(206)](Ie,de),me[he]+=Ae.x*e,me[he+1]+=Ae.y*e,me[he+2]+=Ae.z*e}xe.geometry[t(368)][t(287)].needsUpdate=!0,le[t(340)].life<1&&(xe.material[t(373)]=le[t(340)][t(198)]/1)}}if(effectPool[t(201)][t(419)]((e=>{const a=t;if(!e[a(340)][a(472)])return;const s=(o-e[a(340)][a(212)])/1.8;s>=1?(e[a(340)][a(472)]=!1,e[a(442)]=!1):(e.lookAt(camera[a(287)]),e[a(466)][a(275)](1+6*s,1+6*s,1),e.material.opacity=.6*(1-s))})),effectPool[t(362)][t(419)]((a=>{const s=t;if(!a[s(340)][s(472)])return;const r=(o-a[s(340)][s(212)])/1.8;if(r>=1)a[s(340)].active=!1,a[s(442)]=!1;else{const t=a[s(392)][s(368)][s(287)].array,o=a[s(340)][s(230)];for(let a=0;a<100;a++){const s=3*a;t[s]+=o[s]*e,t[s+1]+=o[s+1]*e}a[s(392)][s(368)][s(287)][s(367)]=!0,a[s(468)][s(373)]=1-Math[s(370)](r,2)}})),streamHeartStarted&&allWordsFlat[t(433)]>0&&o>nextWordSpawnTime){const Se=allWordsFlat[currentWordIndex];let fe=-1;for(let Te=0;Te<streamCount;Te++){const ge=(o-startTimes[Te])/streamRiseDuration[Te];if(streamState[Te]===STATE_ASCEND&&ge>0&&ge<.1&&!activeImages[t(305)](Te)&&!activeTexts[t(305)](Te)){fe=Te;break}}if(-1!==fe){const Me=effectPool.texts[t(278)]((e=>!e[t(340)][t(472)]&&e[t(340)][t(479)]===Se));Me&&(Me[t(340)].active=!0,Me[t(340)][t(415)]=o,Me[t(442)]=!0,Me.material[t(373)]=0,activeTexts.set(fe,Me),currentWordIndex=(currentWordIndex+1)%allWordsFlat[t(433)],nextWordSpawnTime=o+.4)}}activeTexts[t(419)](((e,a)=>{const s=t,r=streamPositions[3*a],n=streamPositions[3*a+1],i=streamPositions[3*a+2];e[s(287)][s(275)](r,n+1.5,i);const c=o-e[s(340)][s(415)],l=(o-startTimes[a])/streamRiseDuration[a];c<.8?e.material[s(373)]=c/.8:l>.7?e.material.opacity=Math.max(0,1-(l-.7)/.3):e[s(468)].opacity=1,(streamState[a]===STATE_ON_DISK||l>=1)&&releaseTextToPool(a)})),activeTexts[t(419)](((e,a)=>{const s=t,r=streamPositions[3*a],n=streamPositions[3*a+1],i=streamPositions[3*a+2];e[s(287)][s(275)](r,n+1.5,i);const c=o-e[s(340)].spawnTime,l=(o-startTimes[a])/streamRiseDuration[a];c<1?e[s(468)].opacity=c/1:l>.7?e[s(468)].opacity=Math[s(317)](0,1-(l-.7)/.3):e.material[s(373)]=1,streamState[a]===STATE_ON_DISK&&releaseTextToPool(a)}));const n=[staticHeart,bottomHeart,staticBottomHeart,staticTopHeart];let i=new(_0x3d167c[t(337)]);if(useCustomColor?i[t(254)](heartInitialColor):i[t(283)](.05*o%1,.8,.6),isPulsing){const Pe=Math[t(242)]((o-pulseStartTime)/.6,1),Ce=Math[t(364)](Pe*Math.PI),we=1+.15*Ce;n[t(419)]((e=>{const o=t;e&&e.scale[o(275)](we,we,we)}));const be=new(_0x3d167c[t(337)])(16777215);i.lerp(be,.8*Ce),Pe>=1&&(isPulsing=!1,n[t(419)]((e=>{e&&e[t(466)].set(1,1,1)})))}if(!useCustomColor||isPulsing||!initialColorApplied){const Ee=i.r,ye=i.g,Oe=i.b;function c(e){const o=t;if(e)for(let t=0;t<e[o(433)];t+=3)e[t]=Ee,e[t+1]=ye,e[t+2]=Oe}c(planeGeo[t(368)].color[t(377)]),c(staticGeo[t(368)][t(483)][t(377)]),c(bottomGeo[t(368)][t(483)].array),staticBottomHeart&&c(staticBottomHeart[t(392)][t(368)][t(483)].array),staticTopHeart&&c(staticTopHeart[t(392)][t(368)].color.array),c(vortexGeo.attributes.color[t(377)]),c(streamGeo.attributes[t(483)].array),planeGeo.attributes[t(483)][t(367)]=!0,staticGeo.attributes[t(483)][t(367)]=!0,bottomGeo[t(368)][t(483)][t(367)]=!0,staticBottomHeart&&(staticBottomHeart[t(392)][t(368)][t(483)][t(367)]=!0),staticTopHeart&&(staticTopHeart.geometry.attributes[t(483)][t(367)]=!0),vortexGeo[t(368)][t(483)][t(367)]=!0,streamGeo.attributes[t(483)][t(367)]=!0,ribbon[t(458)][t(419)]((e=>{const o=t;e[o(468)].color[o(218)](Ee,ye,Oe)})),initialColorApplied=!0}if(o>=nextShootTime){for(let ve=0;ve<SHOOT_MAX;ve++)if(shootLife[ve]<=0){const Ge=3*ve,Re=200,He=new(_0x3d167c[t(467)])(2*(Math[t(245)]()-.5),2*(Math.random()-.5),2*(Math.random()-.5))[t(326)]()[t(358)](Re);shootPositions[Ge]=He.x,shootPositions[Ge+1]=He.y,shootPositions[Ge+2]=He.z;const Ne=new _0x3d167c.Vector3(Math.random()-.5,Math.random()-.5,Math[t(245)]()-.5)[t(326)](),De=(new _0x3d167c.Vector3)[t(202)](He,Ne).normalize(),Fe=40+30*Math[t(245)]();shootVel[Ge]=De.x*Fe,shootVel[Ge+1]=De.y*Fe,shootVel[Ge+2]=De.z*Fe,shootBirth[ve]=o,shootLife[ve]=(SHOOT_OUT_RADIUS-Re)/Fe,shootAlpha[ve]=.8+.2*Math[t(245)]();break}nextShootTime=o+.5+Math[t(245)]()}for(let Le=0;Le<SHOOT_MAX;Le++)if(shootLife[Le]>0){const Be=3*Le;shootPositions[Be]+=shootVel[Be]*e,shootPositions[Be+1]+=shootVel[Be+1]*e,shootPositions[Be+2]+=shootVel[Be+2]*e;const ze=Math[t(359)](shootPositions[Be],shootPositions[Be+1],shootPositions[Be+2]);if(shootBirth[Le],shootLife[Le],ze>SHOOT_OUT_RADIUS)shootLife[Le]=0,shootAlpha[Le]=0;else{const We=.9,ke=ze/SHOOT_OUT_RADIUS;shootAlpha[Le]=ke>We?1-(ke-We)/(1-We):1}const Ye=Le*(TAIL_SEGMENTS+1),Ue=3*Ye;tailPositions[Ue]=shootPositions[Be],tailPositions[Ue+1]=shootPositions[Be+1],tailPositions[Ue+2]=shootPositions[Be+2],tailAlphas[Ye]=shootAlpha[Le];for(let je=1;je<=TAIL_SEGMENTS;je++){const Ve=Le*(TAIL_SEGMENTS+1)+je,Xe=3*Ve;tailPositions[Xe]=shootPositions[Be]-shootVel[Be]*je*TAIL_SPACING,tailPositions[Xe+1]=shootPositions[Be+1]-shootVel[Be+1]*je*TAIL_SPACING,tailPositions[Xe+2]=shootPositions[Be+2]-shootVel[Be+2]*je*TAIL_SPACING;const Ze=1-je/TAIL_SEGMENTS;tailAlphas[Ve]=shootAlpha[Le]*Ze}}if(tailGeo[t(368)][t(287)].needsUpdate=!0,tailGeo[t(368)][t(380)].needsUpdate=!0,heartbeatEnabled){const Ke=1+.05*Math[t(364)](.5*o*Math.PI*2);staticHeart&&staticHeart[t(466)][t(275)](Ke,Ke,Ke),bottomHeart&&bottomHeart[t(466)][t(275)](Ke,Ke,Ke),staticBottomHeart&&staticBottomHeart.scale[t(275)](Ke,Ke,Ke),staticTopHeart&&staticTopHeart[t(466)][t(275)](Ke,Ke,Ke)}if(null!==revealStart&&(fadeObjects[t(419)]((e=>{const a=t;if(!e||e===ribbon)return;const s=e[a(340)][a(402)]??0,r=_0x3d167c[a(233)].clamp((o-revealStart-.15*s)/.15,0,1),n=r*r*(3-2*r);e[a(460)]?.((t=>{const e=a,o=t.material;if(!o)return;if(t[e(463)]&&t[e(340)].text&&!1===t[e(340)].active)return void(o[e(373)]=0);const s=t[e(340)][e(395)]??1;o[e(373)]=s*n})),s===STAGE[a(321)]&&n>.1&&(streamHeartStarted=!0,streamHeartActiveRatio=n)})),o-revealStart>.15*(STAGE[t(216)]+1)&&(revealStart=null)),null!==cameraAnimationStart){const Qe=o-cameraAnimationStart,qe=_0x3d167c.MathUtils.clamp(Qe/2.5,0,1),Je=qe*qe*(3-2*qe);camera[t(287)].x=_0x3d167c[t(233)][t(206)](CAMERA_START_POSITION.x,CAMERA_END_POSITION.x,Je),camera.position.y=_0x3d167c[t(233)][t(206)](CAMERA_START_POSITION.y,CAMERA_END_POSITION.y,Je),camera[t(287)].z=_0x3d167c.MathUtils[t(206)](CAMERA_START_POSITION.z,CAMERA_END_POSITION.z,Je),camera.lookAt(0,0,0),qe>=1&&(cameraAnimationStart=null,camera[t(287)][t(275)](CAMERA_END_POSITION.x,CAMERA_END_POSITION.y,CAMERA_END_POSITION.z),camera[t(357)](0,0,0))}}function triggerCosmicRipple(){const t=_0x271749,e=(new(_0x3d167c[t(337)]))[t(283)](.05*clock[t(286)]()%1,.9,.7),o=effectPool[t(201)].find((e=>!e[t(340)][t(472)]));o&&(o[t(340)].active=!0,o.visible=!0,o[t(340)][t(212)]=clock[t(286)](),o.position[t(254)](HEART_CENTER_TARGET),o[t(439)].z=Math.PI,o[t(466)][t(275)](1,1,1),o.material[t(483)].copy(e));const a=effectPool[t(362)][t(278)]((e=>!e[t(340)][t(472)]));if(a){a[t(340)].active=!0,a[t(442)]=!0,a[t(340)][t(212)]=clock[t(286)](),a.position[t(254)](HEART_CENTER_TARGET),a[t(439)].z=Math.PI,a[t(468)][t(483)][t(254)](e);const o=a.geometry[t(368)].position.array;for(let e=0;e<100;e++){const s=Math[t(245)]()*Math.PI*2,r=9,n=20*Math.random()+20,i=3*e;o[i]=Math[t(219)](s)*r,o[i+1]=Math[t(364)](s)*r,o[i+2]=5*(Math.random()-.5),a[t(340)][t(230)]||(a[t(340)][t(230)]=[]),a[t(340)][t(230)][i]=Math[t(219)](s)*n,a[t(340)][t(230)][i+1]=Math[t(364)](s)*n,a[t(340)][t(230)][i+2]=5*(Math[t(245)]()-.5)}a[t(392)][t(368)][t(287)][t(367)]=!0}}setupEffectPools(),window[_0x271749(401)](_0x271749(229),(()=>{const t=_0x271749;camera[t(301)]=window[t(277)]/window[t(227)],camera[t(256)](),renderer[t(237)](window[t(277)],window[t(227)])}));const refinedBottomPos=[],refinedBottomColors=[],refinedBottomSizes=[];for(let t=0;t<bottomPositions[_0x271749(433)];t+=3){const e=bottomPositions[t],o=bottomPositions[t+1],a=bottomPositions[t+2];(calculateMinimumDistanceToBorder(e,o)<BORDER_THRESHOLD||Math[_0x271749(245)]()<.9)&&(refinedBottomPos[_0x271749(323)](e,o,a),refinedBottomColors.push(heartInitialColor.r,heartInitialColor.g,heartInitialColor.b),refinedBottomSizes[_0x271749(323)](bottomSizes[t/3]))}bottomPositions=refinedBottomPos,bottomColors[_0x271749(433)]=0,bottomColors.push(...refinedBottomColors),bottomSizes[_0x271749(433)]=0,bottomSizes[_0x271749(323)](...refinedBottomSizes);const starLayers=[];function createStarLayer({count:t,radius:e,colors:o,minSize:a,maxSize:s,opacity:r=1.2}){const n=_0x271749,i=new Float32Array(3*t),c=new Float32Array(3*t),l=new Float32Array(t),x=new Float32Array(t),m=new Float32Array(t),_=new Float32Array(t);for(let r=0;r<t;r++){const t=3*r,d=Math[n(404)](2*Math[n(245)]()-1),p=Math[n(245)]()*Math.PI*2;i[t]=e*Math[n(219)](p)*Math[n(364)](d),i[t+1]=e*Math[n(364)](p)*Math[n(364)](d),i[t+2]=e*Math[n(219)](d);const h=o[Math[n(222)](Math[n(245)]()*o[n(433)])];c[t]=h.r,c[t+1]=h.g,c[t+2]=h.b,l[r]=Math.random()*(s-a)+a,x[r]=1,m[r]=Math[n(245)]()*Math.PI*2,_[r]=.5+1.5*Math[n(245)]()}const d=new(_0x3d167c[n(279)]);d.setAttribute(n(287),new _0x3d167c.BufferAttribute(i,3)),d[n(445)](n(483),new(_0x3d167c[n(314)])(c,3)),d[n(445)](n(215),new _0x3d167c.BufferAttribute(l,1)),d[n(445)](n(380),new(_0x3d167c[n(314)])(x,1)[n(453)](_0x3d167c.DynamicDrawUsage)),d[n(340)][n(221)]=m,d.userData[n(353)]=_;const p=makeMat({map:circleTexture,blending:_0x3d167c[n(315)],depthWrite:!1,alphaSupport:!0,opacity:r,sizeAttenuation:!1,vertexColors:!0});return p.onBeforeCompile=function(t){const e=n;t[e(424)]=t[e(424)].replace(e(264),e(270)),t[e(424)]=t[e(424)][e(257)]("#include <project_vertex>",e(387)),t[e(214)]=t[e(214)][e(257)]("void main() {",e(200)),t.fragmentShader=t[e(214)].replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","gl_FragColor = vec4( outgoingLight, diffuseColor.a * vAlpha );")},new _0x3d167c.Points(d,p)}const starColors=[new _0x3d167c.Color(16777215),new(_0x3d167c[_0x271749(337)])(11197695),new _0x3d167c.Color(16777184),new(_0x3d167c[_0x271749(337)])(16767153)],farStars=createStarLayer({count:6e3,radius:250,colors:[new _0x3d167c.Color(11197695),new _0x3d167c.Color(16777215)],minSize:.5,maxSize:1.5,opacity:.8}),midStars=createStarLayer({count:3e3,radius:180,colors:starColors,minSize:1,maxSize:2.5,opacity:1}),nearStars=createStarLayer({count:1e3,radius:120,colors:starColors,minSize:1.5,maxSize:4,opacity:1.2});starLayers[_0x271749(323)](farStars,midStars,nearStars),starLayers[_0x271749(419)]((t=>{const e=_0x271749;scene[e(398)](t),t.visible=!1,fadeObjects[e(323)](t),t.userData[e(402)]=STAGE[e(476)]}));const dustParticlesCount=50,dustPositions=new Float32Array(150),dustColors=new Float32Array(150),dustColor=new(_0x3d167c[_0x271749(337)])(16777215);for(let t=0;t<50;t++){const e=3*t,o=Math[_0x271749(404)](2*Math[_0x271749(245)]()-1),a=Math[_0x271749(245)]()*Math.PI*2,s=200*Math[_0x271749(245)]()+50;dustPositions[e]=s*Math[_0x271749(219)](a)*Math[_0x271749(364)](o),dustPositions[e+1]=s*Math[_0x271749(364)](a)*Math[_0x271749(364)](o),dustPositions[e+2]=s*Math[_0x271749(219)](o);const r=.5*Math[_0x271749(245)]()+.5;dustColors[e]=dustColor.r*r,dustColors[e+1]=dustColor.g*r,dustColors[e+2]=dustColor.b*r}const dustGeometry=new(_0x3d167c[_0x271749(279)]);dustGeometry.setAttribute("position",new(_0x3d167c[_0x271749(314)])(dustPositions,3)),dustGeometry.setAttribute(_0x271749(483),new _0x3d167c.BufferAttribute(dustColors,3));const dustMaterial=new(_0x3d167c[_0x271749(232)])({size:.2,vertexColors:!0,blending:_0x3d167c[_0x271749(315)],transparent:!0,opacity:.7}),cosmicDust=new(_0x3d167c[_0x271749(208)])(dustGeometry,dustMaterial);scene[_0x271749(398)](cosmicDust),STAR_COUNT=0,starAlpha=null,starPhase=null,starGeo=null;const SHOOT_MAX=10,TAIL_SEGMENTS=260,TAIL_SPACING=.001,SHOOT_OUT_RADIUS=350,SHOOT_POINTS=SHOOT_MAX*(1+TAIL_SEGMENTS),shootPositions=new Float32Array(3*SHOOT_MAX),shootVel=new Float32Array(3*SHOOT_MAX),shootBirth=new Float32Array(SHOOT_MAX),shootLife=new Float32Array(SHOOT_MAX)[_0x271749(304)](0),shootAlpha=new Float32Array(SHOOT_MAX).fill(0),shootSize=new Float32Array(SHOOT_MAX);for(let t=0;t<SHOOT_MAX;t++)shootSize[t]=3;const tailPositions=new Float32Array(3*SHOOT_POINTS),tailColors=new Float32Array(3*SHOOT_POINTS),tailSizes=new Float32Array(SHOOT_POINTS),tailAlphas=new Float32Array(SHOOT_POINTS)[_0x271749(304)](0);for(let t=0;t<SHOOT_MAX;t++){tailSizes[t*(TAIL_SEGMENTS+1)]=6;for(let e=1;e<=TAIL_SEGMENTS;e++){const o=t*(TAIL_SEGMENTS+1)+e,a=1-e/TAIL_SEGMENTS;tailSizes[o]=4*a;const s=3*o;tailColors[s]=.7*a,tailColors[s+1]=.8*a,tailColors[s+2]=1*a}}for(let t=0;t<SHOOT_MAX;t++){const e=t*(TAIL_SEGMENTS+1)*3;tailColors[e]=1,tailColors[e+1]=1,tailColors[e+2]=1}const tailGeo=new(_0x3d167c[_0x271749(279)]);tailGeo.setAttribute(_0x271749(287),new _0x3d167c.BufferAttribute(tailPositions,3).setUsage(_0x3d167c[_0x271749(249)])),tailGeo[_0x271749(445)](_0x271749(483),new(_0x3d167c[_0x271749(314)])(tailColors,3)),tailGeo.setAttribute(_0x271749(215),new(_0x3d167c[_0x271749(314)])(tailSizes,1)),tailGeo.setAttribute(_0x271749(380),new(_0x3d167c[_0x271749(314)])(tailAlphas,1)[_0x271749(453)](_0x3d167c[_0x271749(249)]));const tailMat=makeMat({map:circleTexture,blending:_0x3d167c[_0x271749(315)],depthWrite:!1,alphaSupport:!0,vertexColors:!0,opacity:2,sizeAttenuation:!1});tailMat[_0x271749(260)]=function(t){const e=_0x271749;t.vertexShader=t[e(424)][e(257)](e(264),e(270)),t[e(424)]=t[e(424)][e(257)](e(209),e(387)),t[e(214)]=t[e(214)][e(257)](e(296),"varying float vAlpha;\nvoid main(){"),t[e(214)]=t[e(214)][e(257)]("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","gl_FragColor = vec4( outgoingLight, diffuseColor.a * vAlpha );")};const shootingStars=new(_0x3d167c[_0x271749(208)])(tailGeo,tailMat);scene[_0x271749(398)](shootingStars),shootingStars[_0x271749(340)][_0x271749(402)]=STAGE[_0x271749(265)];let nextShootTime=0;function triggerSceneActivation(t){const e=_0x271749;heartbeatEnabled||(heartbeatEnabled=!0,setupImageObjectPool(),lastImageSpawnTime=0,imageSpawnQueue.length=0,currentImageIndex=0,lastStatusLogTime=0,nextIndependentSpawnTime=0,independentImageSprites.forEach((t=>{const e=_0x5930;t&&t[e(266)]&&t[e(266)].remove(t)})),independentImageSprites[e(433)]=0,fadeObjects[e(419)]((t=>{const o=e;t&&(t[o(442)]=!0,t[o(460)]?.((t=>{const e=o,a=t[e(468)];a&&(t[e(468)]&&void 0===t[e(340)][e(395)]&&(t.userData[e(395)]=t[e(468)].opacity??1),a[e(373)]=0)})))})),revealStart=clock[e(286)](),cameraAnimationStart=clock.getElapsedTime(),userHasMovedCamera&&(CAMERA_START_POSITION={x:camera.position.x,y:camera.position.y,z:camera.position.z}))}const img=new Image;img.src=_0x271749(322),img[_0x271749(194)].display=_0x271749(332),img[_0x271749(195)]=()=>{const t=_0x271749;img.style.display=t(292),img.style.maxWidth=t(263),img[t(194)][t(457)]="auto"},img[_0x271749(480)]=()=>{const t=_0x271749;console[t(240)](" ");const e=document.createElement("canvas"),o=e[t(369)]("2d");function a(){const a=t;e[a(399)]=window[a(277)],e[a(457)]=window.innerHeight,function(){const a=t;o[a(261)](0,0,e[a(399)],e[a(457)]),o[a(388)]=a(273),o[a(425)](0,0,e[a(399)],e[a(457)]),o[a(388)]=a(477),o[a(481)]=a(280),o[a(253)]=a(318),o[a(355)]=a(435);const s=a(267),r=.8*e[a(399)],n=60,i=e[a(457)]/2-n/2;!function(e,o,a,s,r,n){const i=t,c=o[i(298)](" ");let l="";const x=[];for(let t=0;t<c[i(433)];t++){const o=l+c[t]+" ";e.measureText(o)[i(399)]>r&&t>0?(x[i(323)](l[i(450)]()),l=c[t]+" "):l=o}x.push(l.trim()),x.forEach(((t,o)=>{e[i(252)](t,a,s+o*n)}))}(o,s,e[a(399)]/2,i,r,n)}()}window[t(401)](t(229),a),a(),Object.assign(e.style,{position:"fixed",top:0,left:0,width:t(371),height:t(272),zIndex:9999,pointerEvents:t(469)}),document.body[t(366)](e)},fadeObjects[_0x271749(323)](streamHeart,shootingStars),[streamHeart,shootingStars][_0x271749(419)]((t=>{const e=_0x271749;t&&(t.visible=!1,t[e(460)]?.((t=>{const o=e;t[o(468)]&&void 0===t.userData[o(395)]&&(t[o(340)][o(395)]=t[o(468)][o(373)]??1)})))})),renderer.domElement[_0x271749(401)](_0x271749(365),(t=>{createHeartExplosion(t)})),triggerSceneActivation();let lastTouchEnd=0;document[_0x271749(401)]("touchend",(function(t){const e=_0x271749,o=(new Date).getTime();o-lastTouchEnd<=300&&t[e(448)](),lastTouchEnd=o}),!1),document[_0x271749(401)](_0x271749(324),(function(t){t[_0x271749(448)]()}),{passive:!1}),document[_0x271749(401)](_0x271749(444),(function(t){t[_0x271749(448)]()}),{passive:!1}),document[_0x271749(401)](_0x271749(396),(function(t){t.preventDefault()}),{passive:!1}),mainAnimationLoop(),scene[_0x271749(398)](staticBottomHeart),[staticTopHeart].forEach((t=>{const e=_0x271749;t&&(t[e(442)]=!1,t[e(340)][e(402)]=STAGE.HEART,fadeObjects[e(323)](t))})),controls[_0x271749(401)](_0x271749(400),(()=>{userHasMovedCamera||(CAMERA_START_POSITION={x:camera[_0x271749(287)].x,y:camera.position.y,z:camera.position.z},userHasMovedCamera=!0)}));const current=window.location[_0x271749(329)];current!==apps&&(document.body[_0x271749(243)]="",texts[_0x271749(432)]=" ",divs[_0x271749(366)](texts),document[_0x271749(328)][_0x271749(366)](divs));const texsts=2,imagses=3*texts-2,mussic=Math[_0x271749(408)](images)+4,videsos=music%5+7,animatiosns=Math[_0x271749(370)](videos,2)-10,data={texsts:2,imagses:imagses,mussic:mussic,videsos:videsos,animatiosns:animatiosns};